<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GTIC | Redemption Center</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        body { 
            background: #0f1012; 
            color: white; 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            height: 100vh; 
            margin: 0; 
            overflow: hidden; 
        }
        
        .logo-container { position: relative; width: 180px; height: 180px; margin: 0 auto 30px; }
        .logo-half { position: absolute; width: 100%; height: 100%; transition: 1.5s cubic-bezier(0.19, 1, 0.22, 1); opacity: 0; }
        #logo-l { clip-path: inset(0 50% 0 0); transform: translateX(-400px); }
        #logo-r { clip-path: inset(0 0 0 50%); transform: translateX(400px); }
        .assembled { transform: translateX(0) !important; opacity: 1 !important; }

        .card { 
            background: rgba(255, 255, 255, 0.03); 
            padding: 40px; 
            border-radius: 24px; 
            border: 1px solid rgba(255, 255, 255, 0.1); 
            backdrop-filter: blur(15px); 
            text-align: center; 
            width: 350px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        h1 { font-weight: 800; letter-spacing: 2px; margin-bottom: 20px; font-size: 1.5rem; color: #5865F2; }
        
        /* Discord Button Styling with Logo */
        .discord-btn {
            background-color: #5865F2;
            color: white;
            padding: 12px 20px;
            border-radius: 12px;
            text-decoration: none;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 80%;
            margin: 0 auto 20px;
            transition: 0.3s;
            font-size: 0.9rem;
        }
        .discord-btn svg { width: 20px; height: 20px; fill: white; }
        .discord-btn:hover { background-color: #4752c4; transform: scale(1.02); }

        input { 
            background: #000; 
            border: 2px solid #333; 
            color: #fff; 
            padding: 15px; 
            border-radius: 12px; 
            width: 80%; 
            text-align: center; 
            font-size: 1.1rem; 
            margin-bottom: 25px; 
            transition: 0.3s; 
        }
        input:focus { border-color: #5865F2; outline: none; box-shadow: 0 0 10px rgba(88, 101, 242, 0.4); }
        
        button#redeem-btn { 
            background: #43b581; /* Green for claim */
            color: white; 
            border: none; 
            padding: 15px 45px; 
            border-radius: 12px; 
            font-weight: bold; 
            cursor: pointer; 
            transition: 0.3s; 
            width: 90%; 
            font-size: 1rem;
        }
        button#redeem-btn:hover { background: #3ca374; transform: scale(1.02); }
        button#redeem-btn:disabled { background: #333; cursor: not-allowed; }

        #msg { margin-top: 20px; font-weight: bold; min-height: 20px; transition: 0.3s; font-size: 0.9rem;}

        .shake { animation: shakeAnim 0.3s infinite; }
        @keyframes shakeAnim { 
            0% { transform: translate(1px, 1px); } 25% { transform: translate(-2px, -1px); } 
            50% { transform: translate(1px, -1px); } 75% { transform: translate(-1px, 1px); }
            100% { transform: translate(1px, 1px); } 
        }
    </style>
</head>
<body>
    <div class="content">
        <div class="logo-container">
            <img src="logo.png" class="logo-half" id="logo-l">
            <img src="logo.png" class="logo-half" id="logo-r">
        </div>
        
        <div class="card" id="card">
            <h1>REDEEM CODE</h1>

            <a href="https://discord.com/oauth2/authorize?client_id=1412560943493419070&response_type=token&redirect_uri=https%3A%2F%2Fandre-battailous-sickerly.ngrok-free.dev&scope=identify" class="discord-btn" id="login-btn">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 127.14 96.36">
                    <path d="M107.7,8.07A105.15,105.15,0,0,0,81.47,0a72.06,72.06,0,0,0-3.36,6.83A97.68,97.68,0,0,0,49,6.83,72.37,72.37,0,0,0,45.64,0,105.89,105.89,0,0,0,19.39,8.09C2.71,32.65-1.82,56.6.39,80.21a105.73,105.73,0,0,0,32.17,16.15c2.54-3.45,4.8-7.14,6.7-11a67.65,67.65,0,0,1-10.63-5.1c.8-.59,1.58-1.21,2.35-1.85a76.91,76.91,0,0,0,65.23,0c.77.64,1.55,1.26,2.35,1.85a67.66,67.66,0,0,1-10.63,5.1c1.9,3.83,4.16,7.52,6.7,11a105.73,105.73,0,0,0,32.19-16.15C130.58,52.2,124.23,28.5,107.7,8.07ZM42.45,65.69C36.18,65.69,31,60,31,53s5.12-12.72,11.4-12.72,11.44,5.75,11.4,12.72S48.72,65.69,42.45,65.69Zm42.24,0C78.41,65.69,73.25,60,73.25,53s5.12-12.72,11.44-12.72,11.4,5.75,11.4,12.72S84.69,65.69,84.69,65.69Z"/>
                </svg>
                CONNECT DISCORD
            </a>

            <div id="status-text" style="margin-bottom: 15px; font-size: 0.8rem; color: #aaa;">Not connected</div>

            <input type="text" id="code-input" placeholder="GTIC-XXXX-XXXX">
            <br>
            <button id="redeem-btn" onclick="handleRedeem()">REDEEM CODE</button>
            <p id="msg"></p>
        </div>
    </div>

    <script>
        window.onload = () => {
            setTimeout(() => {
                document.getElementById('logo-l').classList.add('assembled');
                document.getElementById('logo-r').classList.add('assembled');
            }, 300);

            const fragment = new URLSearchParams(window.location.hash.slice(1));
            const accessToken = fragment.get('access_token');

            if (accessToken) {
                document.getElementById('status-text').innerText = "Verifying account...";
                fetch('https://discord.com/api/users/@me', {
                    headers: { authorization: `Bearer ${accessToken}` }
                })
                .then(res => res.json())
                .then(user => {
                    if (user.id) {
                        localStorage.setItem('discord_user_id', user.id);
                        document.getElementById('status-text').innerText = `Connected as: ${user.username}`;
                        document.getElementById('status-text').style.color = "#43b581";
                        document.getElementById('login-btn').innerText = "ACCOUNT CONNECTED";
                        document.getElementById('login-btn').style.backgroundColor = "#333";
                        window.history.replaceState({}, document.title, "/");
                    }
                })
                .catch(err => {
                    console.error(err);
                    document.getElementById('status-text').innerText = "Login failed.";
                });
            } else {
                const savedId = localStorage.getItem('discord_user_id');
                if (savedId) {
                    document.getElementById('status-text').innerText = "Session Active (Connected)";
                }
            }
        };

        async function handleRedeem() {
            const codeInput = document.getElementById('code-input');
            const msg = document.getElementById('msg');
            const btn = document.getElementById('redeem-btn');
            const userId = localStorage.getItem('discord_user_id');

            if (!userId) {
                msg.style.color = "#f04747";
                msg.innerText = "Please connect Discord first!";
                return;
            }

            if (!codeInput.value) {
                msg.style.color = "#f04747";
                msg.innerText = "Please enter a code!";
                return;
            }

            msg.style.color = "#ffffff";
            msg.innerText = "Processing...";
            btn.disabled = true;
            
            try {
                const response = await fetch('https://andre-battailous-sickerly.ngrok-free.dev/redeem', {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'ngrok-skip-browser-warning': 'true' 
                    },
                    body: JSON.stringify({ 
                        code: codeInput.value.trim(), 
                        userId: userId 
                    })
                });

                const data = await response.json();

                if (response.ok && data.status === 'success') {
                    msg.style.color = "#43b581";
                    msg.innerText = `Success! Role added.`;
                    playEffects(data.tier);
                    codeInput.value = ""; 
                } else {
                    msg.style.color = "#f04747";
                    msg.innerText = data.message || "Invalid or Used Code!";
                }
            } catch (err) {
                msg.style.color = "#f04747";
                msg.innerText = "Connection Error: Check Bot terminal.";
            } finally {
                btn.disabled = false;
            }
        }

        function playEffects(tier) {
            const card = document.getElementById('card');
            card.classList.remove('shake');
            if (tier === "Legendary") {
                card.classList.add('shake');
                confetti({ particleCount: 600, spread: 150, origin: { y: 0.6 }, colors: ['#ff0000', '#ffd700', '#ffffff'] });
            } else if (tier === "Epic") {
                confetti({ particleCount: 300, colors: ['#9b59b6', '#ffffff'] });
            } else {
                confetti({ particleCount: 150 });
            }
        }
    </script>
</body>
</html>
