<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GTIC | Redemption Center</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        body { background: #0f1012; color: white; font-family: 'Segoe UI', sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; overflow: hidden; }
        
        /* Logo Animation Container */
        .logo-container { position: relative; width: 180px; height: 180px; margin: 0 auto 30px; }
        .logo-half { position: absolute; width: 100%; height: 100%; transition: 1.5s cubic-bezier(0.19, 1, 0.22, 1); opacity: 0; }
        
        /* The Left Half: Slides from far left */
        #logo-l { clip-path: inset(0 50% 0 0); transform: translateX(-400px); }
        /* The Right Half: Slides from far right */
        #logo-r { clip-path: inset(0 0 0 50%); transform: translateX(400px); }
        
        /* Class triggered by JS to make them meet in the middle */
        .assembled { transform: translateX(0) !important; opacity: 1 !important; }

        .card { background: rgba(255, 255, 255, 0.03); padding: 40px; border-radius: 24px; border: 1px solid rgba(255, 255, 255, 0.1); backdrop-filter: blur(15px); text-align: center; width: 350px; }
        h1 { font-weight: 800; letter-spacing: 2px; margin-bottom: 30px; font-size: 1.5rem; }
        input { background: #000; border: 2px solid #333; color: #fff; padding: 15px; border-radius: 12px; width: 80%; text-align: center; font-size: 1.1rem; margin-bottom: 25px; transition: 0.3s; }
        input:focus { border-color: #5865F2; outline: none; }
        button { background: #5865F2; color: white; border: none; padding: 15px 45px; border-radius: 12px; font-weight: bold; cursor: pointer; transition: 0.3s; width: 90%; }
        button:hover { background: #4752c4; transform: scale(1.02); }
        #msg { margin-top: 20px; font-weight: bold; min-height: 20px; }

        /* Legendary Shake Effect */
        .shake { animation: shakeAnim 0.3s infinite; }
        @keyframes shakeAnim { 0% { transform: translate(1px, 1px); } 50% { transform: translate(-2px, -1px); } 100% { transform: translate(1px, 1px); } }
    </style>
</head>
<body>
    <div class="content">
        <div class="logo-container">
            <img src="logo.png" class="logo-half" id="logo-l">
            <img src="logo.png" class="logo-half" id="logo-r">
        </div>
        
        <div class="card" id="card">
            <h1>REDEEM CODE</h1>
            <input type="text" id="code-input" placeholder="GTIC-XXXX-XXXX">
            <br>
            <button onclick="handleRedeem()">CLAIM REWARD</button>
            <p id="msg"></p>
        </div>
    </div>

    <script>
        // Trigger logo assembly on page load
        window.onload = () => {
            setTimeout(() => {
                document.getElementById('logo-l').classList.add('assembled');
                document.getElementById('logo-r').classList.add('assembled');
            }, 300);
        };

        async function handleRedeem() {
            const code = document.getElementById('code-input').value;
            const msg = document.getElementById('msg');
            const card = document.getElementById('card');
            
            // !! IMPORTANT: Replace with your actual ID to test before we add OAuth2 !!
            const testUserId = "YOUR_DISCORD_ID_HERE"; 

            msg.innerText = "Processing...";
            
            try {
const response = await fetch('https://andre-battailous-sickerly.ngrok-free.dev/redeem', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ code: code, userId: testUserId })
                });

                const data = await response.json();

                if (data.status === 'success') {
                    msg.style.color = "#43b581";
                    msg.innerText = `Success! Received ${data.tier} tier.`;
                    playEffects(data.tier);
                } else {
                    msg.style.color = "#f04747";
                    msg.innerText = "Invalid or Used Code!";
                }
            } catch (err) {
                msg.style.color = "#f04747";
                msg.innerText = "Connection Error: Is the Pi online?";
            }
        }

        function playEffects(tier) {
            if (tier === "Legendary") {
                document.getElementById('card').classList.add('shake');
                confetti({ particleCount: 600, spread: 150, origin: { y: 0.6 }, colors: ['#ff0000', '#ffd700', '#ffffff'] });
            } else if (tier === "Epic") {
                confetti({ particleCount: 300, colors: ['#9b59b6', '#ffffff'] });
            } else {
                confetti({ particleCount: 150 });
            }
        }
    </script>
</body>
</html>
